---
title: 搭建简单代理池
date: 2022-04-16 00:02:42
categories:
- CS
- security
tags:
- spider
- redis
- proxy
toc: true
---
**摘要：本文基于github上的ProxyPool项目，搭建自己的免费代理池**
<!-- more -->
# 前言
做靶场的sql注入时被禁ip,就想实现不停变换ip的sqlmap。

---
# 一.安装和配置必要依赖
## redis服务
Redis是由C语言编写的开源、基于内存、支持多种数据结构、高性能的Key-Value数据库。

安装好redis后，执行proxypool项目的调度程序和webApi服务程序(调度程序执行得差不多就可退出，但webApi需一直执行才能访问api网站)，然后访问setting里的127.0.0.1:PORT,(PORT为setting中设置的值，如默认的5010)，然后会提示访问不同文件的功能，如访问http://127.0.0.1:5010/get是获得一个代理地址。如下
```
# 启动调度程序
$ python proxyPool.py schedule

# 启动webApi服务
$ python proxyPool.py server
```
![20220416181916](https://cdn.jsdelivr.net/gh/zhangsx19/PicBed/images_for_blogs20220416181916.png)

如图，我们发现它的响应有很多属性，甚至还保留了属性名，而要使用sqlmap的--proxy代理功能需要网站只返回一个代理的地址，后面我自己写了脚本来实现这个功能，并更改端口为5012(只返回可访问https的代理ip)和5011(返回可访问http的代理ip)

# 遇到的问题
`return iter(x.items()) AttributeError: 'int' object has no attribute 'items'`(python向redis数据库插入有序集合)

用sqlmap扫描目标网址总是被封，该怎么利用这个脚本呢？
```
sqlmap -u 目标网址 –proxy = http://127.0.0.1:5000/random 
#即可实现每扫描一次就，变动一次我们扫描器的IP地址(注意没有双引号)
```
要求网站直接输出ip，如图

![20220416173420](https://cdn.jsdelivr.net/gh/zhangsx19/PicBed/images_for_blogs20220416173420.png)

脚本如下；
```
from flask import Flask, request
import os
import setting
from helper.proxy import Proxy
from handler.proxyHandler import ProxyHandler

app = Flask(__name__)
proxy_handler = ProxyHandler()

@app.route('/')
def index():
    return '请在后面加上/get'

@app.route('/get/')
def get():
    https = request.args.get("type", "").lower() == 'https'
    proxy = proxy_handler.get(https)
    return str(proxy.to_dict['proxy'])

if __name__ == '__main__':
    app.run(host=setting.HOST, port=setting.PORT_HTTP)

```

使用之前建议先检测一下代理的有效性：http://h.jiguangdaili.com/check/

---
# 总结
免费代理还是比较少的，而且匿名性也不好，有条件还是得用付费代理。

---
# 参考资料
1. [Linux上安装Redis教程](https://baijiahao.baidu.com/s?id=1722728002073366376&wfr=spider&for=pc)

2. [python向redis数据库插入有序集合](https://blog.csdn.net/zzh2910/article/details/89603192)

3. [【代理池工具撰写】只有无尽的跳转，没有封禁的IP！](https://bbs.zkaq.cn/t/4705.html)

4. [ProxyPool文档](https://proxy-pool.readthedocs.io/zh/latest/user/how_to_use.html)

5. [SqlMap代理池](https://www.cnblogs.com/AtSunset/p/15144553.html)

6. [Sqlmap自动切换代理](https://cloud.tencent.com/developer/article/1535219)

7. [luminati代理快速使用教程](https://www.cnblogs.com/jhao/p/15611785.html)